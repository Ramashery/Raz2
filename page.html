<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Details | Digital Craft</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <main>
        <section id="detail-view">
            <div class="detail-page-header">
                <h1 id="page-title" class="animate-always">Loading...</h1>
                <div id="page-price" class="detail-price"></div>
            </div>
            <div id="page-content" class="detail-content floating-item">
                <!-- Сюда вставится текст из базы -->
            </div>
        </section>

        <!-- Секция похожих записей -->
        <section id="related-posts"></section>
    </main>

    <script type="module">
        const firebaseConfig = { /* Ваш конфиг как выше */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function initPage() {
            // Разбор URL для получения коллекции и слага
            // Пример: /en/services/custom-web-development
            const pathParts = window.location.pathname.split('/').filter(Boolean);
            const lang = pathParts[0] || 'en';
            const collection = pathParts[1] || 'services';
            const slug = pathParts[2];

            const snap = await db.collection(collection)
                                 .where('urlSlug', '==', slug)
                                 .where('lang', '==', lang)
                                 .get();

            if (snap.empty) {
                document.getElementById('page-title').innerText = "404 - Not Found";
                return;
            }

            const data = snap.docs[0].data();

            // Заполнение данных
            document.title = data.seoTitle || data.title;
            document.getElementById('page-title').innerText = data.h1 || data.title;
            document.getElementById('page-price').innerText = data.price || '';
            document.getElementById('page-content').innerHTML = data.mainContent;

            // Запуск анимаций
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('is-visible');
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.animate-always, .floating-item').forEach(el => observer.observe(el));
        }

        initPage();
    </script>
</body>
</html>
